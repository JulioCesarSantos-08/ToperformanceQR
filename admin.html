<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Administrador - ToPerformance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS -->
  <link rel="stylesheet" href="admin.css">

  <!-- JS -->
  <script type="module" src="admin.js"></script>

  <style>
    /* ======== Estilos buscador ======== */
    .buscador-container {
      margin-bottom: 15px;
      text-align: center;
    }

    #buscadorClientes {
      width: 90%;
      max-width: 400px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    #buscadorClientes:focus {
      border-color: #ff0000;
      box-shadow: 0 0 6px rgba(255, 0, 0, 0.4);
    }

    #listaClientes {
      margin-top: 15px;
    }

    /* Modal overlay styles (keeps modal centered when admin.js sets display) */
    #modalEditar {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #modalEditar .editar-form {
      max-width: 520px;
      margin: 0;
      background: white;
      padding: 22px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      width: calc(100% - 40px);
    }

    #modalEditar .botones {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 12px;
    }

    #closeModal {
      position: absolute;
      right: 16px;
      top: 12px;
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }
  </style>
</head>
<body>
  <!-- ======== Encabezado ======== -->
  <header class="header">
    <div class="header-left" style="display:flex; align-items:center; gap:12px;">
      <img src="imagenes/logo1.png" alt="Logo Taller" class="logo" style="height:45px;">
      <h1 style="margin:0; font-size:1.2rem;">Panel de Administrador</h1>
    </div>
    <div class="header-right">
      <span id="adminEmail" style="margin-right:12px;"></span>
      <button id="logoutBtn">Cerrar Sesi√≥n</button>
    </div>
  </header>

  <!-- ======== Contenido principal ======== -->
  <main class="container">
    <!-- Alta de clientes -->
    <section class="card">
      <h2>Dar de Alta Cliente</h2>
      <form id="formAltaCliente">
        <input type="text" id="nombreCliente" placeholder="Nombre del cliente" required>
        <input type="email" id="emailCliente" placeholder="Correo electr√≥nico" required>
        <input type="password" id="passwordCliente" placeholder="Contrase√±a (opcional)">
        <input type="text" id="modeloVehiculo" placeholder="Modelo del veh√≠culo" required>
        <input type="text" id="placaVehiculo" placeholder="Placa" required>
        <input type="text" id="imagenVehiculo" placeholder="Nombre de la imagen (ej. autodejuan.png)">
        <button type="submit">Guardar Cliente</button>
      </form>
      <p class="nota">
        Si introduces contrase√±a, el sistema intentar√° crear la cuenta en Firebase Auth, sin cerrar tu sesi√≥n actual.
      </p>
    </section>

    <!-- Registrar servicios -->
    <section class="card">
      <h2>Registrar Servicio a Cliente</h2>
      <form id="formServicio">
        <select id="clienteSelect" required></select>
        <input type="text" id="servicioNombre" placeholder="Nombre del servicio (ej. Cambio de aceite)" required>
        <input type="date" id="servicioFecha" required>
        <input type="number" id="servicioCosto" placeholder="Costo del servicio" required>
        <textarea id="servicioDescripcion" placeholder="Descripci√≥n del servicio"></textarea>
        <button type="submit">Guardar Servicio</button>
      </form>
    </section>

    <!-- Lista de clientes -->
    <section class="card">
      <h2>Lista de Clientes Registrados</h2>

      <!-- üîç Buscador -->
      <div class="buscador-container">
        <input type="text" id="buscadorClientes" placeholder="Buscar cliente por nombre o correo...">
      </div>

      <div id="listaClientes"></div>
    </section>
  </main>

  <!-- ======== Modal editar cliente (coincide con admin.js) ======== -->
  <div id="modalEditar" aria-hidden="true">
    <div class="editar-form" role="dialog" aria-modal="true" aria-labelledby="tituloEditar">
      <button id="closeModal" aria-label="Cerrar">‚úï</button>
      <h2 id="tituloEditar" style="color:#d00000; margin-top:0;">Editar Cliente</h2>

      <form id="formEditarCliente">
        <label for="editNombre">Nombre del cliente</label>
        <input type="text" id="editNombre" required>

        <label for="editCorreo">Correo electr√≥nico</label>
        <input type="email" id="editCorreo" required>

        <label for="editModelo">Modelo del veh√≠culo</label>
        <input type="text" id="editModelo">

        <label for="editPlaca">Placa</label>
        <input type="text" id="editPlaca">

        <label for="editImagen">Nombre de la imagen (ej. auto.png)</label>
        <input type="text" id="editImagen">

        <div class="botones">
          <button type="submit" id="guardarCambios">Guardar Cambios</button>
          <button type="button" class="cancelar" id="cancelarEdicion">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ======== Script buscador (ajustado a .cliente-card) ======== -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const buscador = document.getElementById('buscadorClientes');
      const lista = document.getElementById('listaClientes');

      buscador.addEventListener('input', () => {
        const termino = buscador.value.toLowerCase().trim();
        const clientes = lista.querySelectorAll('.cliente-card');

        clientes.forEach(cliente => {
          const texto = cliente.textContent.toLowerCase();
          cliente.style.display = texto.includes(termino) ? 'block' : 'none';
        });
      });

      // Cerrar modal local (tambi√©n lo maneja admin.js closeModal listener)
      const cerrar = document.getElementById('closeModal');
      const modal = document.getElementById('modalEditar');
      const cancelar = document.getElementById('cancelarEdicion');

      if (cerrar) cerrar.addEventListener('click', () => modal.style.display = 'none');
      if (cancelar) cancelar.addEventListener('click', () => modal.style.display = 'none');
      // click fuera para cerrar
      window.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
      });
    });
  </script>
</body>
</html>